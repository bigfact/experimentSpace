!function(t){function e(t){var e=this;e.img=t,e.block,e.box,e.canvas,e.canvasCtx,e.state={},e.config={zoomspeed:1.03,maxWidth:1024,minWidth:200}}function n(t,e){var n=i(arguments,2);return function(){return t.apply(e,n.concat(i(arguments)))}}function i(t,e){return e=e>=0?e:0,Array.from?Array.from(t).slice(e):Array.prototype.slice.call(t,e)}function a(t){var e,n;if(t.touches){e=[],n=0==t.touches.length?t.touches=t.changedTouches:t.touches;for(var i=0;i<n.length;i++)e.push({x:n[i].clientX,y:n[i].clientY})}return e=e||[{x:t.clientX||t.pageX,y:t.clientY||t.pageY}]}function o(t){var e=t[0].x-t[1].x,n=t[0].y-t[1].y;return Math.sqrt(e*e+n*n)}function s(t){t.preventDefault(),t.stopPropagation()}return e.prototype={init:function(){var t=this;t.block=document.createElement("div"),t.block.className="imageditor",t.canvas=document.createElement("canvas"),t.block.appendChild(t.canvas),t.canvas.width=t.img.clientWidth,t.canvas.height=t.img.clientHeight,t.canvasCtx=t.canvas.getContext("2d");var e=document.createElement("img");e.src=t.copy(t.img),t.img=e,t.block.appendChild(t.img),t.box=document.createElement("div"),t.box.className="box",t.block.appendChild(t.box),document.body.appendChild(t.block),t.start=n(t.start,t),t.zoom=n(t.zoom,t),t.block.addEventListener("mousedown",t.start,!1),t.block.addEventListener("touchstart",t.start,!1),t.block.addEventListener("mousewheel",t.zoom,!1),t.block.addEventListener("DOMMouseScroll",t.zoom,!1)},start:function(t){var e=this;s(t),e.state.first=a(t),e.state.x=e.img.offsetLeft-e.state.first[0].x,e.state.y=e.img.offsetTop-e.state.first[0].y,e.doing=n(e.doing,e),e.finish=n(e.finish,e),e.block.addEventListener("mousemove",e.doing,!1),e.block.addEventListener("mouseup",e.finish,!1),e.block.addEventListener("touchmove",e.doing,!1),e.block.addEventListener("touchend",e.finish,!1)},doing:function(t){var e=this;s(t),e.state.current=a(t),e.state.current.length<2?(e.img.style.left=e.state.current[0].x+e.state.x+"px",e.img.style.top=e.state.current[0].y+e.state.y+"px"):e.zoom()},finish:function(t){var e=this;s(t),e.state={},e.block.removeEventListener("mousemove",e.doing,!1),e.block.removeEventListener("mouseup",e.finish,!1),e.block.removeEventListener("touchmove",e.doing,!1),e.block.removeEventListener("touchend",e.finish,!1)},zoom:function(t){var e=this,n=0;if(t)s(t),n=t.wheelDelta?t.wheelDelta/120:-(t.detail||0)/3;else{var i=o(e.state.first),a=o(e.state.current);e.state.first=e.state.current,a>i&&(n=1),a<i&&(n=-1)}var c=e.img.clientWidth,r=e.img.clientHeight,h=e.config.zoomspeed;n>0&&(c*=h,r*=h),n<0&&(c/=h,r/=h),c>=e.config.minWidth&&c<=e.config.maxWidth&&(e.img.style.width=c+"px",e.img.style.height=r+"px")},cut:function(){var t=this;return t.img.src=t.copy(t.img),t.canvas.width=200,t.canvas.height=200,t.canvasCtx.drawImage(t.img,t.box.offsetLeft-t.img.offsetLeft,t.box.offsetTop-t.img.offsetTop,t.box.clientWidth,t.box.clientHeight,0,0,t.canvas.width,t.canvas.height),t.canvas.toDataURL()},copy:function(t){var e=this;e.canvas.width=t.clientWidth,e.canvas.height=t.clientHeight,e.canvasCtx.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,e.canvas.width,e.canvas.height);var n=e.canvas.toDataURL();return e.canvas.width=0,e.canvas.height=0,n}},window.Imageditor=e,e}(window);